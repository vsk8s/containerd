From: Shengjing Zhu <zhsj@debian.org>
Date: Tue, 19 May 2020 17:41:51 +0800
Subject: reduce ocicrypt dependency

---
 .../containerd/imgcrypt/images/encryption/client.go   | 19 -------------------
 .../imgcrypt/images/encryption/encryption.go          |  2 ++
 2 files changed, 2 insertions(+), 19 deletions(-)

diff --git a/vendor/github.com/containerd/imgcrypt/images/encryption/client.go b/vendor/github.com/containerd/imgcrypt/images/encryption/client.go
index 6419d59..c664c2e 100644
--- a/vendor/github.com/containerd/imgcrypt/images/encryption/client.go
+++ b/vendor/github.com/containerd/imgcrypt/images/encryption/client.go
@@ -20,12 +20,9 @@ import (
 	"context"
 
 	"github.com/containerd/containerd"
-	"github.com/containerd/containerd/containers"
 	"github.com/containerd/containerd/diff"
-	"github.com/containerd/containerd/errdefs"
 	"github.com/containerd/imgcrypt"
 	"github.com/containerd/typeurl"
-	encconfig "github.com/containers/ocicrypt/config"
 	"github.com/gogo/protobuf/types"
 	ocispec "github.com/opencontainers/image-spec/specs-go/v1"
 	"github.com/pkg/errors"
@@ -65,19 +62,3 @@ func WithUnpackOpts(opts []containerd.UnpackOpt) containerd.RemoteOpt {
 		return nil
 	}
 }
-
-// WithAuthorizationCheck checks the authorization of keys used for encrypted containers
-// be checked upon creation of a container
-func WithAuthorizationCheck(dc *encconfig.DecryptConfig) containerd.NewContainerOpts {
-	return func(ctx context.Context, client *containerd.Client, c *containers.Container) error {
-		image, err := client.ImageService().Get(ctx, c.Image)
-		if errdefs.IsNotFound(err) {
-			// allow creation of container without a existing image
-			return nil
-		} else if err != nil {
-			return err
-		}
-
-		return CheckAuthorization(ctx, client.ContentStore(), image.Target, dc)
-	}
-}
diff --git a/vendor/github.com/containerd/imgcrypt/images/encryption/encryption.go b/vendor/github.com/containerd/imgcrypt/images/encryption/encryption.go
index 59bef8c..feecf86 100644
--- a/vendor/github.com/containerd/imgcrypt/images/encryption/encryption.go
+++ b/vendor/github.com/containerd/imgcrypt/images/encryption/encryption.go
@@ -1,3 +1,5 @@
+// +build ignore
+
 /*
    Copyright The containerd Authors.
 
